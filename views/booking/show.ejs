<% layout("./layouts/boilerplate") %>

<div class="container my-5">
  <div class="card shadow border-0 rounded-4 overflow-hidden">
    
    <!-- Header -->
    <div class="card-header bg-gradient bg-primary text-white py-3">
      <h3 class="mb-0 fw-bold">
        <i class="fas fa-receipt me-2"></i> Booking Details
      </h3>
    </div>

    <div class="card-body p-4">
      
      <!-- Listing Info -->
      <div class="mb-4">
        <h4 class="fw-bold mb-1"><%= booking.listing.title %></h4>
        <p class="text-muted mb-2">
          <i class="fas fa-map-marker-alt me-1 text-danger"></i>
          <%= booking.listing.location %>, <%= booking.listing.country %>
        </p>
        <% if (booking.listing.image && booking.listing.image.url) { %>
          <div class="text-center">
            <img src="<%= booking.listing.image.url %>" 
                 alt="<%= booking.listing.title %>" 
                 class="img-fluid rounded shadow-sm mb-3"
                 style="max-height: 300px; object-fit: cover;">
          </div>
        <% } %>
      </div>

      <!-- Booking Info -->
      <div class="row g-3 mb-4">
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Guest Name:</strong> <%= booking.user.username %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Guests:</strong> <%= booking.guests %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Check-In:</strong> <%= booking.startDate.toDateString() %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Check-Out:</strong> <%= booking.endDate.toDateString() %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Total Price:</strong> 
            <span class="fw-bold text-success">$<%= booking.totalPrice %></span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded-3 p-3 bg-light">
            <strong>Status:</strong> 
            <span class="badge fs-6 px-3 py-2 
              <%= booking.status === 'confirmed' ? 'bg-success' 
              : booking.status === 'pending' ? 'bg-warning text-dark' 
              : 'bg-danger' %>">
              <%= booking.status %>
            </span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="d-flex justify-content-between">
        <a href="/listings/<%= booking.listing._id %>" 
           class="btn btn-outline-primary px-4 rounded-pill">
          <i class="fas fa-arrow-left me-2"></i> Back to Listing
        </a>

        <% if (booking.status !== "cancelled") { %>
          <form method="POST" action="/listings/<%= booking.listing._id %>/booking/<%= booking._id %>?_method=DELETE">
            <button type="submit" class="btn btn-danger px-4 rounded-pill">
              <i class="fas fa-times-circle me-2"></i> Cancel Booking
            </button>
          </form>
        <% } %>
      </div>

    </div>
  </div>
</div>
